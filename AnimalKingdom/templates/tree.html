<!DOCTYPE html>
<html>
<head>
    <title>Animal Kingdom</title>
    <link rel="stylesheet" type="text/css" href="/static/css/site.css" />
</head>
<body>

    <h1>Animal Kingdom</h1>

    <!-- Container for the tree view -->
    <div id="tree"></div>

    <!-- Modal for enlarged images -->
    <div id="imageModal" class="modal hidden">
        <span id="closeModal" class="close">&times;</span>
        <img class="modal-content" id="modalImage" />
        <div id="caption"></div>
    </div>

    <script>
/**
 * Tree data passed from Flask backend
 * @type {Array<Object>}
 */
const treeData = {{ tree | tojson }};

/**
 * Recursively creates a node and its children
 * Adds expand/collapse functionality and image modal
 *
 * @param {Object} node - A node object from treeData
 * @returns {HTMLElement} - <li> element for this node
 */
function createNode(node) {
    const li = document.createElement("li");

    // Node label
    const label = document.createElement("span");
    label.textContent = node.name;
    label.className = "node"; // collapsed by default
    li.appendChild(label);

    // Container for child nodes (hidden initially)
    const childrenContainer = document.createElement("ul");
    childrenContainer.classList.add("hidden");

    // Leaf nodes with images
    if (node.images.length > 0) {
        const imagesDiv = document.createElement("div");
        imagesDiv.className = "images hidden";

        node.images.forEach(img => {
            const image = document.createElement("img");
            image.src = img.path;
            image.alt = img.caption || node.name;
            imagesDiv.appendChild(image);

            /**
             * Click handler to open modal with enlarged image
             */
            image.onclick = () => {
                modal.style.display = "block";
                modalImg.src = image.src;
                captionText.textContent = image.alt;
            };
        });

        li.appendChild(imagesDiv);

        // Clicking the label toggles images for leaf nodes
        label.onclick = () => {
            imagesDiv.classList.toggle("hidden");
            label.classList.toggle("expanded");
        };

        return li; // leaf node done
    }

    // Recursively create children
    node.children.forEach(child => {
        childrenContainer.appendChild(createNode(child));
    });
    li.appendChild(childrenContainer);

    // Click label to toggle child visibility and icon
    label.onclick = () => {
        childrenContainer.classList.toggle("hidden");
        label.classList.toggle("expanded");
    };

    return li;
}

/**
 * Converts tree data to nested <ul> structure
 * @param {Array} data - Root nodes array
 * @returns {HTMLElement} <ul> containing full tree
 */
function renderTree(data) {
    const ul = document.createElement("ul");
    data.forEach(node => ul.appendChild(createNode(node)));
    return ul;
}

// Append tree to container
document.getElementById("tree").appendChild(renderTree(treeData));

/* -----------------------------
   Modal functionality
----------------------------- */
const modal = document.getElementById("imageModal");
const modalImg = document.getElementById("modalImage");
const captionText = document.getElementById("caption");
const closeBtn = document.getElementById("closeModal");

// Close modal on 'Ã—' click
closeBtn.onclick = () => {
    modal.style.display = "none";
};

// Optional: close modal when clicking outside the image
modal.onclick = (e) => {
    if (e.target === modal) {
        modal.style.display = "none";
    }
};
    </script>

</body>
</html>
